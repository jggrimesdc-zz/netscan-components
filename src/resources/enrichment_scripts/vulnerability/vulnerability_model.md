# Vulnerability Data Model

Models for the vulnerabillity dataset. Will expand as more datasets are brought in- presently limited to the nvdcve
model.

\*- Attribute was renamed or remapped from source (but not modified)

\*\*- Attribute is generated outside of source

---

## Vulnerabillity (Base Model)

A vulnerability, independent of source

### Identifiers

- `vulnerbillity_id`\*\*- uuid assigned on data ingress

### References

- `source_id`\*\*- uuid for source

### Data

- `created_at`\*\*- date assigned at ingress
- `updated_at`\*\*- date assigned if record is changed

---

## NVDCVE Vulnerability

A vulnerabillity identified by NVDCVE Database.

### Identifiers

- `vulnerability_id`\*\*- links to the base `vulnerability` model
- `nvdcve_id`\*\*- uuid assigned on data ingress

### References

- `cve_id`- links to `nvdcve.cve` model
- `conifguration_id`- links to `nvdcve.configuration` model
- `impact_id`- links to `nvdcve.impact` model

### Data (vulnerabillity)

- `published_at`- Timestamp record was published
- `last_modified_at`- Timestamp record was modified

### Data (cve)

- `cve_type` - always 'cve'
- `cve_format`- format of cve data
- `cve_version`- version of api when record was retrieved
- `cve_id`\*- id from `cve.cve_data_meta.id`
- `cve_assigner`\*- assigner from `cve.cve_data_meta.assigner`
- `cve_problem_type`\*- type of problem from `cve.problemtype.problemtypedata.description.value`
- `cve_problem_type_lang`\*- language type of problem is in from `cve.problemtype.problemtypedata.description.lang`
- `cve_description`\*- description of cve from `cve.description.description_data.value`
- `cve_description_lang`\*- language of cve description from `cve.description.description_data.lang`

### Data

- `impact_version`\*- mapped from `impact.baseMetricV3.cvssV3.version`
- `impact_vector_string`\*- mapped from `impact.baseMetricV3.cvssV3.vectorString`
- `impact_attack_vector`\*- mapped from `impact.baseMetricV3.cvssV3.attackVector`
- `impact_attack_complexity`\*- mapped from `impact.baseMetricV3.cvssV3.attackComplexity`
- `impact_privileges_required`\*- mapped from `impact.baseMetricV3.cvssV3.privilegesRequired`
- `impact_user_interaction`\*- mapped from `impact.baseMetricV3.cvssV3.userInteraction`
- `impact_scope`\*- mapped from `impact.baseMetricV3.cvssV3.scope`
- `impact_confidentiality_impact`\*- mapped from `impact.baseMetricV3.cvssV3.confidentialityImpact`
- `impact_integrity_impact`\*- mapped from `impact.baseMetricV3.cvssV3.integrityImpact`
- `impact_availability_impact`\*- mapped from `impact.baseMetricV3.cvssV3.avdailabilityImpact`
- `impact_base_score`\*- mapped from `impact.baseMetricV3.cvssV3.baseScore`
- `impact_base_severity`\*- mapped from `impact.baseMetricV3.cvssV3.baseSeverity`
- `impact_exploitability_score`\*- mapped from `impact.baseMetricV3.exploitabilityScore`
- `impact_score`\*- mapped from `impact.baseMetricV3.impactScore`

---

## CVE References

References from CVE `references.reference_data`

### Identifiers

- `reference_id`\*\*- uuid assigned on ingest

### References

- n/a

### Data

- `url`- url of reference
- `name`- name of reference
- `ref_source`\*- name of reference source

---

## Reference Tag

A tag that can be applied to a reference

### Identifiers

- `tag_id`\*\*- uuid assigned on ingest

### References

- n/a

### Data

- `name`- tag name
- `created_at`\*\*- timestamp tag was created

---

## Reference Tags

Tags applied to references

### Identifiers

- n/a

### References

- `reference_id`\*\*- uuid of reference
- `reference_tag_id`\*\*- uuid of tag

### Data

- n/a

---

## Sample queries

- Query by Service/Product version - report vulnerabilities:

``` sql
select 
    vuln.*
from
    nvdcve_vunlerability as vuln
    left join vulnerable_service as serv
        on vuln.vulnerability_id = serv.vulnerability_id
where
    serv.is_vulnerable = true
    and (
        serv.service_name = 'some-service'
        and serv.service_version >= '1.2.3'
    ) 
```

- Query by Service/Product version - report exploits

``` sql
select 
    vuln.cve_type,
    vuln.cve_format,
    vuln.cve_version,
    vuln.cve_id,
    vuln.cve_assigner,
    vuln.cve_problem_type,
    vuln.cve_problem_type_lang,
    vuln.cve_description,
    vuln.cve_description_lang
from
    nvdcve_vunlerability as vuln
    left join vulnerable_service as serv
        on vuln.vulnerability_id = serv.vulnerability_id
where
    serv.is_vulnerable = true
    and (
        serv.service_name = 'some-service'
        and serv.service_version >= '1.2.3'
    ) 
```

- Query by vulnerability - report exploits

``` sql
select 
    vuln.cve_type,
    vuln.cve_format,
    vuln.cve_version,
    vuln.cve_id,
    vuln.cve_assigner,
    vuln.cve_problem_type,
    vuln.cve_problem_type_lang,
    vuln.cve_description,
    vuln.cve_description_lang
from
    nvdcve_vunlerability as vuln
    left join vulnerable_service as serv
        on vuln.vulnerability_id = serv.vulnerability_id
where
    serv.is_vulnerable = true
    and vulnerability_id = '<uuid>'
```
